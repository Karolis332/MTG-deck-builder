appId: com.the-black-grimoire.app
productName: The Black Grimoire
executableName: the-black-grimoire
copyright: Copyright © 2025 The Black Grimoire

directories:
  output: dist-electron
  buildResources: build

# Disable asar — Next.js runs via ELECTRON_RUN_AS_NODE and needs real
# filesystem access to serve .next/static/ assets and load native modules.
asar: false

# Rebuild better-sqlite3 native module for the packaged Electron runtime
afterPack: scripts/afterPack.js

files:
  - "electron-dist/**/*"
  - "electron/**/*.js"
  - "package.json"
  - "next.config.js"
  - "!node_modules"
  - "!.git"
  - "!src/**"
  - "!tests/**"
  - "!scripts/**"
  - "!build/**"

# Extra resources bundled alongside the app (accessible via process.resourcesPath)
# Standalone goes here to bypass electron-builder's node_modules filtering.
extraResources:
  - from: ".next/standalone/"
    to: "standalone"
    filter:
      - "**/*"
  - from: "electron/resources/"
    to: "."
    filter:
      - "**/*"
  - from: "docs/"
    to: "docs"
    filter:
      - "MTG_DECK_BUILDING_KNOWLEDGE.md"
  - from: "scripts/"
    to: "scripts"
    filter:
      - "*.py"
  - from: "data/"
    to: "."
    filter:
      - "arena_grp_ids.json"

mac:
  target:
    - target: dmg
      arch: [x64, arm64]
    - target: zip
      arch: [x64, arm64]
  category: public.app-category.games
  icon: build/icon.icns
  darkModeSupport: true
  hardenedRuntime: true
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist

dmg:
  artifactName: "${productName}-${version}-mac-${arch}.${ext}"
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications

win:
  target:
    - target: nsis
      arch: [x64]
    - target: portable
      arch: [x64]
    - target: zip
      arch: [x64]
  icon: build/icon.ico
  artifactName: "${productName}-${version}-win-${arch}.${ext}"

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  installerIcon: build/icon.ico
  uninstallerIcon: build/icon.ico
  installerHeaderIcon: build/icon.ico
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: The Black Grimoire
  license: LICENSE

portable:
  artifactName: "${productName}-${version}-portable.${ext}"

linux:
  target:
    - target: AppImage
      arch: [x64]
    - target: deb
      arch: [x64]
    - target: tar.gz
      arch: [x64]
  category: Game
  icon: build/icons
  artifactName: "${productName}-${version}-linux-${arch}.${ext}"

appImage:
  license: LICENSE
